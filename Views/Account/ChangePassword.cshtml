@model _125_BCCK.Models.ViewModels.ChangePasswordViewModel

@{
    ViewBag.Title = "Đổi mật khẩu";
}

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-key"></i> Đổi mật khẩu
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <strong>Lưu ý:</strong> Mật khẩu phải có ít nhất 6 ký tự để đảm bảo an toàn.
                    </div>

                    @using (Html.BeginForm("ChangePassword", "Account", FormMethod.Post, new { @class = "needs-validation" }))
                    {
                        @Html.AntiForgeryToken()

                        <!-- Mật khẩu hiện tại -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-lock text-primary"></i> Mật khẩu hiện tại
                                <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                @Html.PasswordFor(m => m.CurrentPassword, new { @class = "form-control", placeholder = "Nhập mật khẩu hiện tại", id = "currentPassword" })
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('currentPassword')">
                                    <i class="fas fa-eye" id="currentPassword-icon"></i>
                                </button>
                            </div>
                            @Html.ValidationMessageFor(m => m.CurrentPassword, "", new { @class = "text-danger small" })
                        </div>

                        <hr />

                        <!-- Mật khẩu mới -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                <i class="fas fa-key text-success"></i> Mật khẩu mới
                                <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                @Html.PasswordFor(m => m.NewPassword, new { @class = "form-control", placeholder = "Nhập mật khẩu mới (tối thiểu 6 ký tự)", id = "newPassword" })
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('newPassword')">
                                    <i class="fas fa-eye" id="newPassword-icon"></i>
                                </button>
                            </div>
                            @Html.ValidationMessageFor(m => m.NewPassword, "", new { @class = "text-danger small" })

                            <!-- Password strength indicator -->
                            <div id="passwordStrength" class="mt-2" style="display: none;">
                                <div class="progress" style="height: 5px;">
                                    <div id="strengthBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small id="strengthText" class="text-muted"></small>
                            </div>
                        </div>

                        <!-- Xác nhận mật khẩu mới -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-check-circle text-success"></i> Xác nhận mật khẩu mới
                                <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                @Html.PasswordFor(m => m.ConfirmPassword, new { @class = "form-control", placeholder = "Nhập lại mật khẩu mới", id = "confirmPassword" })
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirmPassword')">
                                    <i class="fas fa-eye" id="confirmPassword-icon"></i>
                                </button>
                            </div>
                            @Html.ValidationMessageFor(m => m.ConfirmPassword, "", new { @class = "text-danger small" })
                        </div>

                        <hr />

                        <!-- Buttons -->
                        <div class="d-flex justify-content-between">
                            <a href="@Url.Action("Profile", "Account")" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Quay lại
                            </a>
                            <button type="submit" class="btn btn-warning btn-lg">
                                <i class="fas fa-save"></i> Đổi mật khẩu
                            </button>
                        </div>
                    }
                </div>
            </div>

            <!-- Mẹo bảo mật -->
            <div class="card shadow-sm mt-3">
                <div class="card-body">
                    <h6 class="text-primary">
                        <i class="fas fa-shield-alt"></i> Mẹo tạo mật khẩu mạnh
                    </h6>
                    <ul class="small mb-0">
                        <li>Sử dụng ít nhất 8 ký tự</li>
                        <li>Kết hợp chữ hoa, chữ thường, số và ký tự đặc biệt</li>
                        <li>Không sử dụng thông tin cá nhân dễ đoán</li>
                        <li>Không dùng lại mật khẩu cũ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>

    <script>
        // Toggle hiển thị mật khẩu
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(inputId + '-icon');

            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        $(document).ready(function() {
            // Kiểm tra độ mạnh mật khẩu
            $('#newPassword').on('input', function() {
                const password = $(this).val();
                const strengthDiv = $('#passwordStrength');
                const strengthBar = $('#strengthBar');
                const strengthText = $('#strengthText');

                if (password.length === 0) {
                    strengthDiv.hide();
                    return;
                }

                strengthDiv.show();

                let strength = 0;
                let text = '';
                let color = '';

                // Tính điểm
                if (password.length >= 6) strength += 25;
                if (password.length >= 10) strength += 25;
                if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 25;
                if (/[0-9]/.test(password)) strength += 15;
                if (/[^a-zA-Z0-9]/.test(password)) strength += 10;

                // Đánh giá
                if (strength < 40) {
                    text = 'Yếu';
                    color = 'bg-danger';
                } else if (strength < 70) {
                    text = 'Trung bình';
                    color = 'bg-warning';
                } else {
                    text = 'Mạnh';
                    color = 'bg-success';
                }

                strengthBar.css('width', strength + '%')
                    .removeClass('bg-danger bg-warning bg-success')
                    .addClass(color);
                strengthText.text('Độ mạnh: ' + text);
            });

            // Auto-dismiss alerts
            setTimeout(function() {
                $('.alert-success, .alert-danger').fadeOut('slow');
            }, 5000);
        });
    </script>
}